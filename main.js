(()=>{"use strict";function e(e){e.classList.add("popup_opened"),document.addEventListener("keydown",q),e.addEventListener("click",L)}function t(){var e=document.querySelector(".popup_opened");e.classList.remove("popup_opened"),e.removeEventListener("click",L),document.removeEventListener("keydown",q),e.querySelector(".popup__form").reset()}var n={baseURL:"https://nomoreparties.co/v1/plus-cohort7",headers:{authorization:"85b3513c-7007-47da-98aa-43089a80409b","Content-Type":"application/json"}};function r(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function o(e){console.log(e)}function c(e){return fetch(n.baseURL+e,{headers:n.headers}).then(r)}function a(e,t){return fetch(n.baseURL+"/users/me".concat(t),{method:"PATCH",headers:n.headers,body:JSON.stringify(e)}).then(r)}function u(e,t,c){return fetch(n.baseURL+"/cards/likes/".concat(e),{method:t,headers:n.headers}).then(r).then((function(e){c.textContent=e.likes.length})).catch(o)}var i=document.querySelector("#name"),s=document.querySelector("#about"),d=document.querySelector("#avatarLink"),l=document.querySelector(".profile__button_type_edit"),p=document.querySelector(".profile__button_type_add"),v=document.querySelector("#profilePopup"),_=document.querySelector("#avatarPopup"),f=document.querySelector(".profile__avatar-change"),m=document.querySelector("#addCardPopup"),y=document.querySelector(".profile__name"),h=document.querySelector(".profile__description"),S=document.querySelector(".profile__avatar");function q(e){"Escape"===e.key&&t()}function L(e){e.target.classList.contains("popup_opened")&&t()}l.addEventListener("click",(function(){e(v),i.value=y.textContent,s.value=h.textContent})),p.addEventListener("click",(function(){e(m)})),f.addEventListener("click",(function(){e(_)}));var b=document.querySelector("#card-template").content,k=document.querySelector(".popup__picture"),E=document.querySelector(".popup__caption"),C=document.querySelector("#PlaceName"),g=document.querySelector("#PlaceLink"),x=document.querySelector("#picPopup"),P=document.querySelector(".cards__list");function A(t,c){var a=b.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__button"),s=a.querySelector(".card__like-counter"),d=a.querySelector(".card__delete-button");return function(e,t,n){t.likes.some((function(e){return e._id===n._id}))?(e.querySelector(".card__like").classList.add("card__like_active"),e.dataset.isLiked="true"):e.dataset.isLiked="false"}(a,t,c),a.setAttribute("data-cardID",t._id),a.querySelector(".card__pic").src=t.link,a.querySelector(".card__pic").alt=t.name,a.querySelector(".card__pic").addEventListener("click",(function(){e(x),k.src=t.link,E.textContent=t.name,k.alt=E.textContent})),a.querySelector(".card__text").textContent=t.name,i.addEventListener("click",(function(e){!function(e,t,n){var r=e.target.closest(".card");"true"===r.dataset.isLiked?(u(t._id,"DELETE",n),r.dataset.isLiked="false",e.target.classList.remove("card__like_active")):(u(t._id,"PUT",n),r.dataset.isLiked="true",e.target.classList.add("card__like_active"))}(e,t,s)})),s.textContent=t.likes.length,t.owner._id===c._id?d.addEventListener("click",(function(e){var c;(c=t._id,fetch(n.baseURL+"/cards/".concat(c),{method:"DELETE",headers:n.headers}).then(r).catch(o)).then((function(){e.target.closest(".card").remove()}))})):d.remove(),a}function U(e,t,n){var r=e.querySelector(".".concat(n.submitButton));!0===function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(r.classList.add(n.submitButtonInactive),r.setAttribute("disabled","disabled")):(r.classList.remove(n.submitButtonInactive),r.removeAttribute("disabled"))}var D=document.querySelector("#profile-form"),R=document.querySelector("#addForm"),T=document.querySelector("#avatarForm"),B=document.querySelectorAll(".popup__close-button"),w=Array.from(document.querySelectorAll(".popup__form")),I={submitButton:"popup__save-button",submitButtonInactive:"popup__save-button_disabled",inputElement:"popup__input",inputErrorClass:"popup__input_error",errorClass:"popup__input-error_active"};w.forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(".".concat(t.inputElement)));U(e,n,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var r=t.id,o=e.querySelector(".".concat(r,"-error"));o.classList.remove(n.errorClass),o.textContent="",t.classList.remove(n.inputErrorClass)}(e,t,n):function(e,t,n,r){var o=t.id,c=e.querySelector(".".concat(o,"-error"));c.classList.add(r.errorClass),c.textContent=n,t.classList.add(r.inputErrorClass)}(e,t,t.validationMessage,n)}(e,r,t),U(e,n,t)}))}))}(e,I)})),B.forEach((function(e){e.addEventListener("click",t)})),D.addEventListener("submit",(function(e){e.preventDefault();var n=v.querySelector(".popup__save-button");n.value="Сохранение...",function(e,t,n){return a(e,"").then((function(e){t.textContent=e.name,n.textContent=e.about})).catch(o)}({name:i.value,about:s.value},y,h).finally((function(){n.value="Сохранить",t()}))})),T.addEventListener("submit",(function(e){e.preventDefault();var n,r,c=_.querySelector(".popup__save-button");c.value="Сохранение...",(n={avatar:d.value},r=S,a(n,"/avatar").then((function(e){r.src=e.avatar})).catch(o)).finally((function(){c.value="Сохранить",t()}))})),R.addEventListener("submit",(function(e){e.preventDefault();var c,a=m.querySelector(".popup__save-button");a.value="Сохранение...",console.log(e.target),(c={name:C.value,link:g.value},fetch(n.baseURL+"/cards",{method:"POST",headers:n.headers,body:JSON.stringify(c)}).then(r).catch(o)).then((function(e){P.prepend(A(e,e.owner)),console.log(e)})).finally((function(){a.value="Создать",t()}))}));var N=[c("/users/me"),c("/cards")];Promise.all(N).then((function(e){var t=e[0],n=e[1];y.textContent=t.name,h.textContent=t.about,S.src=t.avatar,n.forEach((function(e){P.append(A(e,t))}))})).catch((function(e){console.log(e)}))})();