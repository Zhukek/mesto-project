(()=>{"use strict";function e(e){e.classList.add("popup_opened"),document.addEventListener("keydown",b),e.addEventListener("click",S)}function t(){var e=document.querySelector(".popup_opened");e.classList.remove("popup_opened"),e.removeEventListener("click",S),document.removeEventListener("keydown",b)}var n={baseURL:"https://nomoreparties.co/v1/plus-cohort7",headers:{authorization:"85b3513c-7007-47da-98aa-43089a80409b","Content-Type":"application/json"}};function o(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function r(e){return fetch(n.baseURL+e,{headers:n.headers}).then(o)}function c(e,t){return fetch(n.baseURL+"/users/me".concat(t),{method:"PATCH",headers:n.headers,body:JSON.stringify(e)}).then(o)}function a(e,t,r){return fetch(n.baseURL+"/cards/likes/".concat(e),{method:t,headers:n.headers}).then(o).then((function(e){r.textContent=e.likes.length}))}var u=document.querySelector("#name"),i=document.querySelector("#about"),s=document.querySelector("#avatarLink"),l=document.querySelector(".profile__button_type_edit"),d=document.querySelector(".profile__button_type_add"),p=document.querySelector("#profilePopup"),_=document.querySelector("#avatarPopup"),v=document.querySelector(".profile__avatar-change"),f=document.querySelector("#addCardPopup"),m=document.querySelector(".profile__name"),y=document.querySelector(".profile__description"),h=document.querySelector(".profile__avatar");function b(e){"Escape"===e.key&&t()}function S(e){e.target.classList.contains("popup_opened")&&t()}function L(e){var t=e.querySelector(".popup__form");t.querySelector(".popup__save-button").classList.contains("popup__save-button_disabled")&&t.reset()}l.addEventListener("click",(function(){e(p),u.value=m.textContent,i.value=y.textContent})),d.addEventListener("click",(function(){L(f),e(f)})),v.addEventListener("click",(function(){L(_),e(_)}));var q=document.querySelector("#card-template").content,k=document.querySelector(".popup__picture"),E=document.querySelector(".popup__caption"),C=document.querySelector("#PlaceName"),g=document.querySelector("#PlaceLink"),x=document.querySelector("#picPopup"),P=document.querySelector(".cards__list");function A(t,r){var c=q.querySelector(".card").cloneNode(!0),u=c.querySelector(".card__button"),i=c.querySelector(".card__like-counter"),s=c.querySelector(".card__delete-button");return function(e,t,n){t.likes.some((function(e){return e._id===n._id}))?(e.querySelector(".card__like").classList.add("card__like_active"),e.dataset.isLiked="true"):e.dataset.isLiked="false"}(c,t,r),c.setAttribute("data-cardID",t._id),c.querySelector(".card__pic").src=t.link,c.querySelector(".card__pic").alt=t.name,c.querySelector(".card__pic").addEventListener("click",(function(){e(x),k.src=t.link,E.textContent=t.name,k.alt=E.textContent})),c.querySelector(".card__text").textContent=t.name,u.addEventListener("click",(function(e){!function(e,t,n){var o=e.target.closest(".card");"true"===o.dataset.isLiked?a(t._id,"DELETE",n).then((function(){o.dataset.isLiked="false",e.target.classList.remove("card__like_active")})).catch((function(e){console.log(e)})):a(t._id,"PUT",n).then((function(){o.dataset.isLiked="true",e.target.classList.add("card__like_active")})).catch((function(e){console.log(e)}))}(e,t,i)})),i.textContent=t.likes.length,t.owner._id===r._id?s.addEventListener("click",(function(e){var r;(r=t._id,fetch(n.baseURL+"/cards/".concat(r),{method:"DELETE",headers:n.headers}).then(o)).then((function(){e.target.closest(".card").remove()})).catch((function(e){console.log(e)}))})):s.remove(),c}function U(e,t,n){var o=e.querySelector(".".concat(n.submitButton));!0===function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(o.classList.add(n.submitButtonInactive),o.setAttribute("disabled","disabled")):(o.classList.remove(n.submitButtonInactive),o.removeAttribute("disabled"))}var D=document.querySelector("#profile-form"),R=document.querySelector("#addForm"),T=document.querySelector("#avatarForm"),B=document.querySelectorAll(".popup__close-button"),w=Array.from(document.querySelectorAll(".popup__form")),I={submitButton:"popup__save-button",submitButtonInactive:"popup__save-button_disabled",inputElement:"popup__input",inputErrorClass:"popup__input_error",errorClass:"popup__input-error_active"};w.forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(".".concat(t.inputElement)));U(e,n,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=t.id,r=e.querySelector(".".concat(o,"-error"));r.classList.remove(n.errorClass),r.textContent="",t.classList.remove(n.inputErrorClass)}(e,t,n):function(e,t,n,o){var r=t.id,c=e.querySelector(".".concat(r,"-error"));c.classList.add(o.errorClass),c.textContent=n,t.classList.add(o.inputErrorClass)}(e,t,t.validationMessage,n)}(e,o,t),U(e,n,t)}))}))}(e,I)})),B.forEach((function(e){e.addEventListener("click",t)})),D.addEventListener("submit",(function(e){e.preventDefault();var n=p.querySelector(".popup__save-button");n.value="Сохранение...",function(e,t,n){return c(e,"").then((function(e){t.textContent=e.name,n.textContent=e.about}))}({name:u.value,about:i.value},m,y).then((function(){t()})).catch((function(e){console.log(e)})).finally((function(){n.value="Сохранить"}))})),T.addEventListener("submit",(function(e){e.preventDefault();var n,o,r=_.querySelector(".popup__save-button");r.value="Сохранение...",(n={avatar:s.value},o=h,c(n,"/avatar").then((function(e){o.src=e.avatar}))).then((function(){t()})).catch((function(e){console.log(e)})).finally((function(){r.value="Сохранить"}))})),R.addEventListener("submit",(function(e){e.preventDefault();var r,c=f.querySelector(".popup__save-button");c.value="Сохранение...",(r={name:C.value,link:g.value},fetch(n.baseURL+"/cards",{method:"POST",headers:n.headers,body:JSON.stringify(r)}).then(o)).then((function(e){P.prepend(A(e,e.owner))})).then((function(){c.classList.add("popup__save-button_disabled"),c.setAttribute("disabled","disabled"),t()})).catch((function(e){console.log(e)})).finally((function(){c.value="Создать"}))}));var N=[r("/users/me"),r("/cards")];Promise.all(N).then((function(e){var t=e[0],n=e[1];m.textContent=t.name,y.textContent=t.about,h.src=t.avatar,n.forEach((function(e){P.append(A(e,t))}))})).catch((function(e){console.log(e)}))})();